import{j as e}from"./query-vendor.8wxMU1ov.js";import{r as u,u as X,R as Ee}from"./router-vendor.hUHkLMlj.js";import{c as W,L as ue,u as ae,a as xe,b as ke,d as je,e as Te,C as c,B as i,f as ge,T as P,M as V,g as Le,h as De,i as Me,S as se,I as H,j as Re,k as Ie,l as Pe,m as Fe,n as Oe,o as $e}from"./admin-pages.BUna6bVg.js";import{t as E,B as he,U as be,F as Ne,k as ye,C as J,l as ze,m as Ue,f as me,A as Y,P as re,S as pe,E as oe,d as ee,X as Be,e as qe,T as ve,g as He,D as We,n as Ke,L as Ve,j as we}from"./ui-vendor.D9emdPb2.js";const Ce=u.createContext({}),Z=()=>{const S=u.useContext(Ce);if(!S)throw new Error("useAuth must be used within an AuthProvider");return S},Ze=({children:S})=>{const[g,A]=u.useState(null),[j,N]=u.useState(!0),[R,f]=u.useState(!1);u.useEffect(()=>{(()=>{try{const d=localStorage.getItem(W.auth.tokenKey),a=localStorage.getItem(W.auth.userKey);if(d&&a){const y=JSON.parse(a);A(y),f(!0)}}catch(d){ue.error("Error checking auth:",d),localStorage.removeItem(W.auth.tokenKey),localStorage.removeItem(W.auth.userKey)}finally{N(!1)}})()},[]);const h={user:g,isLoading:j,isAuthenticated:R,login:async p=>{try{N(!0);const d=await Ye(p);if(d.success){const{user:a,token:y}=d.data;return localStorage.setItem(W.auth.tokenKey,y),localStorage.setItem(W.auth.userKey,JSON.stringify(a)),A(a),f(!0),E.success(`Welcome back, ${a.full_name}!`),{success:!0,user:a}}else throw new Error(d.message||"Login failed")}catch(d){return ue.error("Login error:",d),E.error(d.message||"Login failed. Please try again."),{success:!1,error:d.message}}finally{N(!1)}},logout:()=>{try{localStorage.removeItem(W.auth.tokenKey),localStorage.removeItem(W.auth.userKey),A(null),f(!1),E.success("Logged out successfully")}catch(p){ue.error("Logout error:",p)}},hasPermission:p=>!R||!g?!1:g.role==="admin"?!0:Array.isArray(p)?p.includes(g.role):g.role===p};return e.jsx(Ce.Provider,{value:h,children:S})},Ye=async S=>{const{email:g,password:A}=S,j=await fetch(`${W.api.baseURL}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:g,password:A})});if(!j.ok){const R=await j.json();throw new Error(R.detail||"Login failed")}const N=await j.json();return{success:!0,data:{user:N.user,token:N.access_token}}},es=()=>{const{user:S}=Z(),g=S?.teacher_id||S?.teacherId;if(!g)return e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center p-6 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx("div",{className:"text-yellow-600 mb-2",children:e.jsx("svg",{className:"h-8 w-8 mx-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.464 0L3.34 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("h3",{className:"text-lg font-medium text-yellow-900 mb-2",children:"Teacher Profile Incomplete"}),e.jsx("p",{className:"text-yellow-700",children:"Your teacher profile is not properly set up. Please contact the administrator."})]})});const{data:A=[],isLoading:j}=ae(g),{data:N=[],isLoading:R}=xe(g),{data:f=[]}=ke(g),{data:v=[]}=je(g),{data:m=[]}=Te(),n=X();return j||R?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-6",children:[e.jsx(c,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center",children:[e.jsx("div",{className:"flex-shrink-0 mb-2 sm:mb-0",children:e.jsx(he,{className:"h-6 w-6 sm:h-8 sm:w-8 text-blue-600"})}),e.jsxs("div",{className:"sm:ml-4",children:[e.jsx("p",{className:"text-lg sm:text-2xl font-bold text-gray-900",children:A.length}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500",children:"My Classes"})]})]})}),e.jsx(c,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center",children:[e.jsx("div",{className:"flex-shrink-0 mb-2 sm:mb-0",children:e.jsx(be,{className:"h-6 w-6 sm:h-8 sm:w-8 text-green-600"})}),e.jsxs("div",{className:"sm:ml-4",children:[e.jsx("p",{className:"text-lg sm:text-2xl font-bold text-gray-900",children:N.length}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500",children:"My Students"})]})]})}),e.jsx(c,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center",children:[e.jsx("div",{className:"flex-shrink-0 mb-2 sm:mb-0",children:e.jsx(Ne,{className:"h-6 w-6 sm:h-8 sm:w-8 text-purple-600"})}),e.jsxs("div",{className:"sm:ml-4",children:[e.jsx("p",{className:"text-lg sm:text-2xl font-bold text-gray-900",children:f.length}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500",children:"Subjects"})]})]})}),e.jsx(c,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center",children:[e.jsx("div",{className:"flex-shrink-0 mb-2 sm:mb-0",children:e.jsx(ye,{className:"h-6 w-6 sm:h-8 sm:w-8 text-red-600"})}),e.jsxs("div",{className:"sm:ml-4",children:[e.jsx("p",{className:"text-lg sm:text-2xl font-bold text-gray-900",children:v.length}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500",children:"Exams"})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 sm:gap-4 lg:hidden",children:[e.jsxs(i,{variant:"outline",className:"flex flex-col items-center p-4 h-auto space-y-2",onClick:()=>n("/teacher/classes"),children:[e.jsx(he,{className:"h-6 w-6 text-blue-600"}),e.jsx("span",{className:"text-xs font-medium",children:"Classes"})]}),e.jsxs(i,{variant:"outline",className:"flex flex-col items-center p-4 h-auto space-y-2",onClick:()=>n("/teacher/students"),children:[e.jsx(be,{className:"h-6 w-6 text-green-600"}),e.jsx("span",{className:"text-xs font-medium",children:"Students"})]}),e.jsxs(i,{variant:"outline",className:"flex flex-col items-center p-4 h-auto space-y-2",onClick:()=>n("/teacher/attendance"),children:[e.jsx(J,{className:"h-6 w-6 text-orange-600"}),e.jsx("span",{className:"text-xs font-medium",children:"Attendance"})]}),e.jsxs(i,{variant:"outline",className:"flex flex-col items-center p-4 h-auto space-y-2",onClick:()=>n("/teacher/exams"),children:[e.jsx(ye,{className:"h-6 w-6 text-purple-600"}),e.jsx("span",{className:"text-xs font-medium",children:"Exams"})]}),e.jsxs(i,{variant:"outline",className:"flex flex-col items-center p-4 h-auto space-y-2",onClick:()=>n("/teacher/results"),children:[e.jsx(Ne,{className:"h-6 w-6 text-indigo-600"}),e.jsx("span",{className:"text-xs font-medium",children:"Results"})]}),e.jsxs(i,{variant:"outline",className:"flex flex-col items-center p-4 h-auto space-y-2",onClick:()=>n("/teacher/materials"),children:[e.jsx(ze,{className:"h-6 w-6 text-red-600"}),e.jsx("span",{className:"text-xs font-medium",children:"Materials"})]}),e.jsxs(i,{variant:"outline",className:"flex flex-col items-center p-4 h-auto space-y-2",onClick:()=>n("/teacher/schedule"),children:[e.jsx(J,{className:"h-6 w-6 text-teal-600"}),e.jsx("span",{className:"text-xs font-medium",children:"Schedule"})]}),e.jsxs(i,{variant:"outline",className:"flex flex-col items-center p-4 h-auto space-y-2",onClick:()=>n("/teacher/notices"),children:[e.jsx(Ue,{className:"h-6 w-6 text-yellow-600"}),e.jsx("span",{className:"text-xs font-medium",children:"Notices"})]})]}),e.jsxs(c,{children:[e.jsx(c.Header,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(c.Title,{className:"text-lg sm:text-xl",children:"My Classes"}),e.jsx(i,{size:"sm",onClick:()=>n("/teacher/classes"),className:"hidden sm:flex",children:"View All"})]})}),e.jsx(c.Content,{className:"p-4 sm:p-6",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4",children:A.slice(0,3).map(h=>e.jsx(c,{className:"border border-gray-200",children:e.jsxs(c.Content,{className:"p-4",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:h.name}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("p",{children:["Grade ",h.grade," • Section ",h.section||"N/A"]}),e.jsxs("p",{children:["Capacity: ",h.capacity]})]}),e.jsxs(i,{size:"sm",className:"w-full mt-3",onClick:()=>n("/teacher/attendance"),children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Mark Attendance"]})]})},h.id))})})]}),e.jsxs(c,{children:[e.jsx(c.Header,{className:"p-4 sm:p-6",children:e.jsx(c.Title,{className:"text-lg sm:text-xl",children:"Recent Notices"})}),e.jsx(c.Content,{className:"p-4 sm:p-6",children:m.length>0?e.jsx("div",{className:"space-y-3",children:m.slice(0,3).map(h=>e.jsxs("div",{className:"border-l-4 border-blue-500 pl-3 sm:pl-4 py-2",children:[e.jsx("h4",{className:"font-medium text-gray-900 text-sm sm:text-base",children:h.title}),e.jsxs("p",{className:"text-xs sm:text-sm text-gray-600 mt-1",children:[h.content.substring(0,100),"..."]}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:new Date(h.created_at).toLocaleDateString()})]},h.id))}):e.jsx("p",{className:"text-gray-500 text-sm",children:"No recent notices"})})]})]})},ss=()=>{const S=X(),{user:g,isLoading:A}=Z(),j=g?.teacher_id||g?.teacherId;if(A)return e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(!j)return e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsxs("div",{className:"text-center p-6 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx("div",{className:"text-red-600 mb-2",children:e.jsx(me,{className:"h-8 w-8 mx-auto"})}),e.jsx("h3",{className:"text-lg font-medium text-red-900 mb-2",children:"Teacher Profile Not Found"}),e.jsx("p",{className:"text-red-700",children:"Unable to load classes. Please contact the administrator to ensure your teacher profile is properly set up."})]})});const{data:N=[],isLoading:R}=ae(j),{data:f=[]}=xe(j),{data:v=[]}=ge(j),m=n=>(v?.filter(a=>a.class_id===n)||[]).map(a=>a.subject).filter(Boolean).filter((a,y,w)=>y===w.findIndex(x=>x.id===a.id));return R?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(i,{variant:"outline",size:"sm",onClick:()=>S("/teacher"),className:"lg:hidden",children:e.jsx(Y,{className:"h-4 w-4"})}),e.jsx("h2",{className:"text-lg sm:text-xl font-semibold",children:"My Classes"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6",children:N.map(n=>{const h=m(n.id);return e.jsxs(c,{children:[e.jsx(c.Header,{className:"p-4 sm:p-6",children:e.jsx(c.Title,{className:"text-base sm:text-lg",children:n.name})}),e.jsxs(c.Content,{className:"p-4 sm:p-6 pt-0",children:[e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Grade:"})," ",n.grade]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Section:"})," ",n.section||"N/A"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Capacity:"})," ",n.capacity]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Students:"})," ",f.filter(p=>p.class_id===n.id).length]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Subjects:"}),e.jsx("p",{className:"text-xs text-gray-600",children:h.length>0?h.map(p=>p.name).join(", "):"No subjects assigned"})]})]}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsxs(i,{className:"w-full",size:"sm",onClick:()=>S("/teacher/attendance"),children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Mark Attendance"]}),e.jsxs(i,{variant:"outline",className:"w-full",size:"sm",onClick:()=>S("/teacher/exams"),children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Create Exam"]})]})]})]},n.id)})})]})},as=()=>{const S=X(),{user:g,isLoading:A}=Z(),j=g?.teacher_id||g?.teacherId;if(A)return e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(!j)return e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsxs("div",{className:"text-center p-6 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx("div",{className:"text-red-600 mb-2",children:e.jsx(Y,{className:"h-8 w-8 mx-auto"})}),e.jsx("h3",{className:"text-lg font-medium text-red-900 mb-2",children:"Teacher Profile Not Found"}),e.jsx("p",{className:"text-red-700",children:"Your teacher profile is not properly set up. Please contact the administrator."})]})});const{data:N=[],isLoading:R}=xe(j),{data:f=[]}=ae(j),[v,m]=u.useState(!1),[n,h]=u.useState(null),[p,d]=u.useState(""),[a,y]=u.useState(""),[w,x]=u.useState("name"),T=l=>{h(l),m(!0)},O=N.filter(l=>{const k=!p||l.user?.full_name?.toLowerCase().includes(p.toLowerCase())||l.roll_number?.toLowerCase().includes(p.toLowerCase())||l.user?.email?.toLowerCase().includes(p.toLowerCase()),U=!a||l.class_id===parseInt(a);return k&&U}).sort((l,k)=>{switch(w){case"name":return(l.user?.full_name||"").localeCompare(k.user?.full_name||"");case"roll":return(l.roll_number||"").localeCompare(k.roll_number||"");case"class":return l.class_id-k.class_id;default:return 0}});return R?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(i,{variant:"outline",size:"sm",onClick:()=>S("/teacher"),className:"lg:hidden",children:e.jsx(Y,{className:"h-4 w-4"})}),e.jsx("h2",{className:"text-lg sm:text-xl font-semibold",children:"My Students"})]}),e.jsx(c,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(pe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by name, roll number, or email...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:p,onChange:l=>d(l.target.value)})]})}),e.jsx("div",{className:"w-full sm:w-48",children:e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:a,onChange:l=>y(l.target.value),children:[e.jsx("option",{value:"",children:"All Classes"}),f.map(l=>e.jsx("option",{value:l.id,children:l.name},l.id))]})}),e.jsx("div",{className:"w-full sm:w-48",children:e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:w,onChange:l=>x(l.target.value),children:[e.jsx("option",{value:"name",children:"Sort by Name"}),e.jsx("option",{value:"roll",children:"Sort by Roll Number"}),e.jsx("option",{value:"class",children:"Sort by Class"})]})})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",O.length," of ",N.length," students"]}),e.jsx("div",{className:"flex items-center gap-2",children:(p||a||w!=="name")&&e.jsx(i,{variant:"outline",size:"sm",onClick:()=>{d(""),y(""),x("name")},children:"Clear Filters"})})]})]})}),e.jsx("div",{className:"block sm:hidden space-y-3",children:O&&O.length>0?O.map(l=>e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:l.user?.full_name||"N/A"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Roll: ",l.roll_number]})]}),e.jsx(i,{size:"sm",variant:"outline",onClick:()=>T(l),children:e.jsx(oe,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[e.jsxs("p",{children:["Email: ",l.user?.email||"N/A"]}),e.jsxs("p",{children:["Class: ",f.find(k=>k.id===l.class_id)?.name||`Class ${l.class_id}`]}),e.jsxs("p",{children:["Parent: ",l.parent_name||"N/A"]})]})]})},l.id)):e.jsx(c,{className:"p-8 text-center",children:e.jsx("p",{className:"text-gray-500",children:"No students found matching your filters."})})}),e.jsx(c,{className:"hidden sm:block",children:e.jsx(c.Content,{className:"p-0",children:O&&O.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(P,{children:[e.jsx(P.Header,{children:e.jsxs(P.Row,{children:[e.jsx(P.Head,{children:"Roll Number"}),e.jsx(P.Head,{children:"Full Name"}),e.jsx(P.Head,{className:"hidden md:table-cell",children:"Email"}),e.jsx(P.Head,{children:"Class"}),e.jsx(P.Head,{className:"hidden lg:table-cell",children:"Parent Name"}),e.jsx(P.Head,{children:"Actions"})]})}),e.jsx(P.Body,{children:O.map(l=>e.jsxs(P.Row,{children:[e.jsx(P.Cell,{children:l.roll_number}),e.jsx(P.Cell,{children:l.user?.full_name||"N/A"}),e.jsx(P.Cell,{className:"hidden md:table-cell",children:l.user?.email||"N/A"}),e.jsx(P.Cell,{children:f.find(k=>k.id===l.class_id)?.name||`Class ${l.class_id}`}),e.jsx(P.Cell,{className:"hidden lg:table-cell",children:l.parent_name||"N/A"}),e.jsx(P.Cell,{children:e.jsx(i,{size:"sm",variant:"outline",onClick:()=>T(l),children:e.jsx(oe,{className:"h-4 w-4"})})})]},l.id))})]})}):e.jsx("div",{className:"p-8 text-center",children:e.jsx("p",{className:"text-gray-500",children:"No students found matching your filters."})})})}),e.jsx(V,{isOpen:v,onClose:()=>m(!1),title:"Student Details",className:"sm:max-w-lg",children:n?e.jsxs("div",{className:"space-y-4 p-2 sm:p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Full Name:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:n.user?.full_name||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Username:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:n.user?.username||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Email:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:n.user?.email||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Phone:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:n.user?.phone||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Roll Number:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:n.roll_number||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Class:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:f.find(l=>l.id===n?.class_id)?.name||`Class ${n?.class_id}`||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Parent Name:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:n.parent_name||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Parent Phone:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:n.parent_phone||"N/A"})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Address:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:n.address||"N/A"})]})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx("button",{onClick:()=>m(!1),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Close"})})]}):e.jsx("div",{children:"Loading..."})})]})},ts=()=>{const S=X(),{user:g,isLoading:A}=Z(),j=g?.teacher_id||g?.teacherId;if(A)return e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(!j)return e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsxs("div",{className:"text-center p-6 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx("div",{className:"text-red-600 mb-2",children:e.jsx(me,{className:"h-8 w-8 mx-auto"})}),e.jsx("h3",{className:"text-lg font-medium text-red-900 mb-2",children:"Teacher Profile Not Found"}),e.jsx("p",{className:"text-red-700",children:"Your teacher profile is not properly set up. Please contact the administrator."})]})});const{data:N=[]}=ae(j),{data:R=[]}=xe(j),f=Le(),v=De(),[m,n]=u.useState(""),[h,p]=u.useState(new Date().toISOString().split("T")[0]),[d,a]=u.useState({}),[y,w]=u.useState(!1),[x,T]=u.useState(!1),{data:O=[]}=Me(m,h?`${h}T00:00:00`:null),l=R.filter(r=>m?r.class_id===parseInt(m):!1);Ee.useEffect(()=>{if(O.length>0){const r={};O.forEach(_=>{r[_.student_id]={status:_.status,id:_.id}}),a(r),T(!0)}else m&&(a({}),T(!1))},[O,m]);const k=(r,_)=>{a(I=>({...I,[r]:x?{...I[r],status:_}:_}))},U=async()=>{if(!m||!h||Object.keys(d).length===0){E.error("Please select class, date and mark attendance");return}try{if(x){const r=Object.entries(d).map(([_,I])=>{if(I&&I.id&&I.status){const $=O.find(D=>D.id===I.id);return v.mutateAsync({attendanceId:I.id,student_id:$.student_id,class_id:$.class_id,date:$.date,status:I.status,remarks:$.remarks})}return Promise.resolve()});await Promise.all(r),E.success(`Attendance updated successfully for ${r.length} students!`)}else{const r=`${h}T00:00:00`,_=Object.entries(d).map(([I,$])=>({student_id:parseInt(I),class_id:parseInt(m),date:r,status:$,remarks:null}));await f.mutateAsync(_),E.success(`Attendance marked successfully for ${_.length} students!`)}w(!1),x||(T(!0),E.success("Attendance submitted successfully! You can now edit it if needed."))}catch(r){E.error(`Failed to ${x?"update":"mark"} attendance: ${r.response?.data?.detail||r.message}`)}},G=()=>{const r={};l.forEach(_=>{r[_.id]=x?{...d[_.id],status:"present"}:"present"}),a(r),E.success(`Marked all ${l.length} students as present`)},te=()=>{const r={};l.forEach(_=>{r[_.id]=x?{...d[_.id],status:"absent"}:"absent"}),a(r),E.success(`Marked all ${l.length} students as absent`)},K=()=>{a({}),E.success("Cleared all attendance marks")};return e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center space-y-3 sm:space-y-0",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(i,{variant:"outline",size:"sm",onClick:()=>S("/teacher"),className:"lg:hidden",children:e.jsx(Y,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-gray-900",children:"Mark Attendance"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Track student attendance for your classes"})]})]}),m&&e.jsxs("div",{className:"bg-blue-50 px-4 py-2 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-blue-900",children:N.find(r=>r.id===parseInt(m))?.name}),e.jsx("p",{className:"text-xs text-blue-600",children:h})]})]}),e.jsx(c,{className:"p-6 shadow-lg border-0 bg-gradient-to-r from-white to-gray-50",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(se,{label:"Select Class",value:m,onChange:r=>{n(r.target.value),a({})},options:[{value:"",label:"Choose a class"},...N.map(r=>({value:r.id,label:r.name}))],className:"text-base"}),e.jsx(H,{label:"Date",type:"date",value:h,onChange:r=>p(r.target.value),className:"text-base"})]}),m&&Object.keys(d).length===0&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(ee,{className:"h-5 w-5 text-yellow-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-yellow-800",children:"Ready to mark attendance"}),e.jsx("p",{className:"text-xs text-yellow-700 mt-1",children:"Select present/absent for each student below, then submit"})]})]})}),e.jsx("div",{className:"flex justify-center",children:e.jsxs(i,{onClick:()=>w(!0),disabled:!m||Object.keys(d).length===0,className:"px-8 py-3 text-base font-medium bg-blue-600 hover:bg-blue-700 disabled:bg-gray-300",children:[x?"Update Attendance":"Submit Attendance"," (",Object.keys(d).length," marked)"]})})]})}),m&&e.jsxs(c,{className:"shadow-lg border-0",children:[e.jsx(c.Header,{className:"p-6 bg-gradient-to-r from-blue-50 to-indigo-50 border-b",children:e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-start space-y-3 sm:space-y-0",children:[e.jsxs("div",{children:[e.jsxs(c.Title,{className:"text-lg font-bold text-gray-900",children:["Students in ",N.find(r=>r.id===parseInt(m))?.name]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[l.length," students • ",Object.keys(d).length," marked"]})]}),e.jsxs("div",{className:"w-full sm:w-48",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-600 mb-1",children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[Math.round(Object.keys(d).length/Math.max(l.length,1)*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${Object.keys(d).length/Math.max(l.length,1)*100}%`}})})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs(i,{size:"sm",variant:"outline",onClick:G,disabled:l.length===0,className:"text-green-600 border-green-300 hover:bg-green-50 disabled:text-gray-400 disabled:border-gray-200 font-medium",children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"All Present"]}),e.jsxs(i,{size:"sm",variant:"outline",onClick:te,disabled:l.length===0,className:"text-red-600 border-red-300 hover:bg-red-50 disabled:text-gray-400 disabled:border-gray-200 font-medium",children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"All Absent"]}),e.jsxs(i,{size:"sm",variant:"outline",onClick:K,disabled:Object.keys(d).length===0,className:"text-gray-600 border-gray-300 hover:bg-gray-50 disabled:text-gray-400 disabled:border-gray-200 font-medium",children:[e.jsx(Be,{className:"h-4 w-4 mr-2"}),"Clear All"]})]})]})}),e.jsx(c.Content,{className:"p-0",children:l.length>0?e.jsx("div",{className:"divide-y divide-gray-100",children:l.map((r,_)=>e.jsx("div",{className:"p-4 sm:p-6 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-3 sm:space-y-0",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-medium text-blue-600",children:_+1})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900 text-base",children:r.user?.full_name||"N/A"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Roll No: ",e.jsx("span",{className:"font-medium",children:r.roll_number})]})]})]}),e.jsxs("div",{className:"flex gap-3 w-full sm:w-auto",children:[e.jsxs(i,{size:"sm",variant:(x?d[r.id]?.status:d[r.id])==="present"?"default":"outline",onClick:()=>k(r.id,"present"),className:`flex-1 sm:flex-none py-2 px-4 font-medium transition-all duration-200 ${(x?d[r.id]?.status:d[r.id])==="present"?"bg-green-600 hover:bg-green-700 text-white border-green-600 shadow-md":"text-green-600 border-green-300 hover:bg-green-50 hover:border-green-400"}`,children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Present"]}),e.jsxs(i,{size:"sm",variant:(x?d[r.id]?.status:d[r.id])==="absent"?"default":"outline",onClick:()=>k(r.id,"absent"),className:`flex-1 sm:flex-none py-2 px-4 font-medium transition-all duration-200 ${(x?d[r.id]?.status:d[r.id])==="absent"?"bg-red-600 hover:bg-red-700 text-white border-red-600 shadow-md":"text-red-600 border-red-300 hover:bg-red-50 hover:border-red-400"}`,children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Absent"]})]})]})},r.id))}):e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto bg-gray-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(ee,{className:"h-8 w-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Students Found"}),e.jsx("p",{className:"text-gray-500",children:"There are no students in the selected class."})]})})]}),!m&&e.jsxs(c,{className:"p-12 text-center",children:[e.jsx("div",{className:"w-20 h-20 mx-auto bg-blue-100 rounded-full flex items-center justify-center mb-6",children:e.jsx(ee,{className:"h-10 w-10 text-blue-600"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-3",children:"Select a Class"}),e.jsx("p",{className:"text-gray-600 max-w-md mx-auto",children:"Choose a class from the dropdown above to start marking attendance for your students."})]}),e.jsx(V,{isOpen:y,onClose:()=>w(!1),title:x?"Confirm Attendance Update":"Confirm Attendance Submission",className:"sm:max-w-lg",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center",children:e.jsx(ee,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-900",children:"Attendance Summary"}),e.jsxs("p",{className:"text-sm text-blue-700",children:[N.find(r=>r.id===parseInt(m))?.name," • ",h]})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg text-center border border-green-200",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:Object.values(d).filter(r=>x?r?.status==="present":r==="present").length}),e.jsx("div",{className:"text-sm font-medium text-green-700",children:"Present"})]}),e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg text-center border border-red-200",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:Object.values(d).filter(r=>x?r?.status==="absent":r==="absent").length}),e.jsx("div",{className:"text-sm font-medium text-red-700",children:"Absent"})]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-700 text-base",children:x?"Are you ready to update this attendance record?":"Are you ready to submit this attendance record?"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:x?"This will update the existing attendance data.":"This action cannot be undone."})]}),e.jsxs("div",{className:"flex flex-col-reverse sm:flex-row justify-end space-y-3 space-y-reverse sm:space-y-0 sm:space-x-4",children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>w(!1),className:"px-6 py-2",children:"Cancel"}),e.jsx(i,{onClick:U,loading:x?v.isPending:f.isPending,className:"px-6 py-2 bg-blue-600 hover:bg-blue-700",children:(x?v.isPending:f.isPending)?x?"Updating...":"Submitting...":x?"Confirm & Update":"Confirm & Submit"})]})]})})]})},ls=()=>{const S=X(),{user:g,isLoading:A}=Z(),j=g?.teacher_id||g?.teacherId;if(A)return e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(!j)return e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsxs("div",{className:"text-center p-6 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx("div",{className:"text-red-600 mb-2",children:e.jsx(Y,{className:"h-8 w-8 mx-auto"})}),e.jsx("h3",{className:"text-lg font-medium text-red-900 mb-2",children:"Teacher Profile Not Found"}),e.jsx("p",{className:"text-red-700",children:"Your teacher profile is not properly set up. Please contact the administrator."})]})});const{data:N=[],isLoading:R}=je(j),{data:f=[]}=ae(j),{data:v=[]}=ge(j),m=Re(),n=Ie(),h=Pe(),p=s=>s?(v?.filter(Q=>Q.class_id===parseInt(s))||[]).map(Q=>Q.subject).filter(Boolean).filter((Q,_e,Se)=>_e===Se.findIndex(Ae=>Ae.id===Q.id)):[],[d,a]=u.useState(!1),[y,w]=u.useState(!1),[x,T]=u.useState(!1),[O,l]=u.useState(!1),[k,U]=u.useState(null),[G,te]=u.useState(null),[K,r]=u.useState(""),[_,I]=u.useState(""),[$,D]=u.useState(""),[z,b]=u.useState(""),[le,ne]=u.useState("date"),[o,M]=u.useState({title:"",subject_id:"",class_id:"",exam_date:"",duration_minutes:60,total_marks:100,instructions:""}),ce=async s=>{s.preventDefault();try{await m.mutateAsync({name:o.title,max_marks:o.total_marks,exam_date:o.exam_date,duration_minutes:o.duration_minutes,instructions:o.instructions,teacher_id:j,subject_id:parseInt(o.subject_id),class_id:parseInt(o.class_id)}),a(!1),M({title:"",subject_id:"",class_id:"",exam_date:"",duration_minutes:60,total_marks:100,instructions:""}),E.success("Exam created successfully!")}catch{E.error("Failed to create exam")}},ie=s=>{U(s),T(!0)},B=s=>{U(s),M({title:s.title||s.name||"",subject_id:s.subject_id?.toString()||"",class_id:s.class_id?.toString()||"",exam_date:s.exam_date?new Date(s.exam_date).toISOString().slice(0,16):"",duration_minutes:s.duration_minutes||60,total_marks:s.total_marks||s.max_marks||100,instructions:s.instructions||""}),w(!0)},t=s=>{te(s),l(!0)},C=async s=>{s.preventDefault();try{await n.mutateAsync({id:k.id,name:o.title,max_marks:o.total_marks,exam_date:o.exam_date,duration_minutes:o.duration_minutes}),w(!1),U(null),M({title:"",subject_id:"",class_id:"",exam_date:"",duration_minutes:60,total_marks:100,instructions:""}),E.success("Exam updated successfully!")}catch{E.error("Failed to update exam")}},F=async()=>{try{await h.mutateAsync(G.id),l(!1),te(null),E.success("Exam deleted successfully!")}catch{E.error("Failed to delete exam")}},q=N.filter(s=>{const L=!K||s.title?.toLowerCase().includes(K.toLowerCase())||s.subject?.name?.toLowerCase().includes(K.toLowerCase()),de=!_||s.subject_id===parseInt(_),fe=!$||s.class_id===parseInt($),Q=!z||s.exam_date?.startsWith(z);return L&&de&&fe&&Q}).sort((s,L)=>{switch(le){case"title":return(s.title||"").localeCompare(L.title||"");case"date":return new Date(s.exam_date)-new Date(L.exam_date);case"subject":return(s.subject?.name||"").localeCompare(L.subject?.name||"");case"class":return(s.class?.name||"").localeCompare(L.class?.name||"");default:return 0}});return R?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center space-y-3 sm:space-y-0",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(i,{variant:"outline",size:"sm",onClick:()=>S("/teacher"),className:"lg:hidden",children:e.jsx(Y,{className:"h-4 w-4"})}),e.jsx("h2",{className:"text-lg sm:text-xl font-semibold",children:"My Exams"})]}),e.jsxs(i,{onClick:()=>a(!0),size:"sm",children:[e.jsx(re,{className:"h-4 w-4 mr-1 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Create Exam"}),e.jsx("span",{className:"sm:hidden",children:"Create"})]})]}),e.jsx(c,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(pe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search exams by title or subject...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:K,onChange:s=>r(s.target.value)})]})}),e.jsx("div",{className:"w-full lg:w-48",children:e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:_,onChange:s=>I(s.target.value),children:[e.jsx("option",{value:"",children:"All Subjects"}),Array.from(new Set(v?.map(s=>s.subject).filter(Boolean)||[]),s=>s.id).map(s=>{const L=v.find(de=>de.subject?.id===s)?.subject;return L?e.jsx("option",{value:L.id,children:L.name},L.id):null})]})}),e.jsx("div",{className:"w-full lg:w-48",children:e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:$,onChange:s=>D(s.target.value),children:[e.jsx("option",{value:"",children:"All Classes"}),f.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})}),e.jsx("div",{className:"w-full lg:w-48",children:e.jsx("input",{type:"month",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:z,onChange:s=>b(s.target.value)})}),e.jsx("div",{className:"w-full lg:w-48",children:e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:le,onChange:s=>ne(s.target.value),children:[e.jsx("option",{value:"date",children:"Sort by Date"}),e.jsx("option",{value:"title",children:"Sort by Title"}),e.jsx("option",{value:"subject",children:"Sort by Subject"}),e.jsx("option",{value:"class",children:"Sort by Class"})]})})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",q.length," of ",N.length," exams"]}),(K||_||$||z||le!=="date")&&e.jsx(i,{variant:"outline",size:"sm",onClick:()=>{r(""),I(""),D(""),b(""),ne("date")},children:"Clear Filters"})]})]})}),e.jsx("div",{className:"space-y-4",children:q.length>0?q.map(s=>e.jsx(c,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-start space-y-2 sm:space-y-0",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-sm sm:text-base",children:s.title}),e.jsxs("p",{className:"text-gray-600 text-sm",children:[s.subject?.name," • ",s.class?.name]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(i,{size:"sm",variant:"outline",onClick:()=>ie(s),children:e.jsx(oe,{className:"h-4 w-4"})}),e.jsx(i,{size:"sm",variant:"outline",onClick:()=>B(s),children:e.jsx(qe,{className:"h-4 w-4"})}),e.jsx(i,{size:"sm",variant:"outline",onClick:()=>t(s),children:e.jsx(ve,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-xs sm:text-sm text-gray-500",children:[e.jsxs("span",{children:["Date: ",new Date(s.exam_date).toLocaleDateString()]}),e.jsxs("span",{children:["Duration: ",s.duration_minutes," mins"]}),e.jsxs("span",{children:["Marks: ",s.total_marks]})]})]})},s.id)):N.length>0?e.jsx(c,{className:"p-8 text-center",children:e.jsx("p",{className:"text-gray-500",children:"No exams found matching your filters."})}):e.jsx(c,{className:"p-8 text-center",children:e.jsx("p",{className:"text-gray-500",children:"No exams created yet"})})}),e.jsx(V,{isOpen:d,onClose:()=>a(!1),title:"Create New Exam",className:"sm:max-w-lg",children:e.jsxs("form",{onSubmit:ce,className:"space-y-4",children:[e.jsx(H,{label:"Exam Title",value:o.title,onChange:s=>M({...o,title:s.target.value}),required:!0}),e.jsx(se,{label:"Class",value:o.class_id,onChange:s=>M({...o,class_id:s.target.value,subject_id:""}),options:[{value:"",label:"Select class"},...f.map(s=>({value:s.id,label:s.name}))],required:!0}),e.jsx(se,{label:"Subject",value:o.subject_id,onChange:s=>M({...o,subject_id:s.target.value}),options:[{value:"",label:"Select subject"},...p(o.class_id).map(s=>({value:s.id,label:s.name}))],required:!0}),e.jsx(H,{label:"Exam Date",type:"datetime-local",value:o.exam_date,onChange:s=>M({...o,exam_date:s.target.value}),required:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(H,{label:"Duration (minutes)",type:"number",value:o.duration_minutes,onChange:s=>M({...o,duration_minutes:parseInt(s.target.value)}),required:!0}),e.jsx(H,{label:"Total Marks",type:"number",value:o.total_marks,onChange:s=>M({...o,total_marks:parseInt(s.target.value)}),required:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Instructions"}),e.jsx("textarea",{className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-sm",rows:3,value:o.instructions,onChange:s=>M({...o,instructions:s.target.value}),placeholder:"Enter exam instructions..."})]}),e.jsxs("div",{className:"flex flex-col-reverse sm:flex-row justify-end space-y-2 space-y-reverse sm:space-y-0 sm:space-x-3",children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>a(!1),children:"Cancel"}),e.jsx(i,{type:"submit",loading:m.isPending,children:"Create Exam"})]})]})}),e.jsx(V,{isOpen:x,onClose:()=>T(!1),title:"Exam Details",className:"sm:max-w-lg",children:k?e.jsxs("div",{className:"space-y-4 p-2 sm:p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Title:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:k.title})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Subject:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:k.subject?.name||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Class:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:k.class?.name||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Date:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:new Date(k.exam_date).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Duration:"}),e.jsxs("span",{className:"ml-2 text-gray-900",children:[k.duration_minutes," minutes"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Total Marks:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:k.total_marks})]}),k.instructions&&e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Instructions:"}),e.jsx("div",{className:"mt-1 p-2 bg-gray-50 rounded border",children:e.jsx("span",{className:"text-gray-900",children:k.instructions})})]})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx("button",{onClick:()=>T(!1),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Close"})})]}):e.jsx("div",{children:"Loading..."})}),e.jsx(V,{isOpen:y,onClose:()=>w(!1),title:"Edit Exam",className:"sm:max-w-lg",children:e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsx(H,{label:"Exam Title",value:o.title,onChange:s=>M({...o,title:s.target.value}),required:!0}),e.jsx(se,{label:"Class",value:o.class_id,onChange:s=>M({...o,class_id:s.target.value,subject_id:""}),options:[{value:"",label:"Select class"},...f.map(s=>({value:s.id,label:s.name}))],required:!0}),e.jsx(se,{label:"Subject",value:o.subject_id,onChange:s=>M({...o,subject_id:s.target.value}),options:[{value:"",label:"Select subject"},...p(o.class_id).map(s=>({value:s.id,label:s.name}))],required:!0}),e.jsx(H,{label:"Exam Date",type:"datetime-local",value:o.exam_date,onChange:s=>M({...o,exam_date:s.target.value}),required:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(H,{label:"Duration (minutes)",type:"number",value:o.duration_minutes,onChange:s=>M({...o,duration_minutes:parseInt(s.target.value)}),required:!0}),e.jsx(H,{label:"Total Marks",type:"number",value:o.total_marks,onChange:s=>M({...o,total_marks:parseInt(s.target.value)}),required:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Instructions"}),e.jsx("textarea",{className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-sm",rows:3,value:o.instructions,onChange:s=>M({...o,instructions:s.target.value}),placeholder:"Enter exam instructions..."})]}),e.jsxs("div",{className:"flex flex-col-reverse sm:flex-row justify-end space-y-2 space-y-reverse sm:space-y-0 sm:space-x-3",children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>w(!1),children:"Cancel"}),e.jsx(i,{type:"submit",loading:n.isPending,children:"Update Exam"})]})]})}),e.jsx(V,{isOpen:O,onClose:()=>l(!1),title:"Delete Exam",className:"sm:max-w-md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(ve,{className:"h-6 w-6 text-red-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Delete Exam"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:['Are you sure you want to delete "',G?.title,'"? This action cannot be undone.']})]})]}),e.jsxs("div",{className:"flex flex-col-reverse sm:flex-row justify-end space-y-2 space-y-reverse sm:space-y-0 sm:space-x-3",children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>l(!1),children:"Cancel"}),e.jsx(i,{type:"button",variant:"danger",onClick:F,loading:h.isPending,children:"Delete Exam"})]})]})})]})},rs=()=>{const S=X(),{user:g}=Z(),A=g?.teacher_id||g?.teacherId,{data:j=[],isLoading:N}=je(A),{data:R=[]}=ae(A),{data:f=[]}=ke(A),[v,m]=u.useState(""),{data:n=[],isLoading:h}=Fe(v?{exam_id:v}:{}),p=Oe(),d=$e(),[a,y]=u.useState(!1),[w,x]=u.useState(!1),[T,O]=u.useState(!1),[l,k]=u.useState(null),[U,G]=u.useState(""),[te,K]=u.useState(""),[r,_]=u.useState(""),[I,$]=u.useState("student_name"),[D,z]=u.useState({student_id:"",obtained_marks:"",remarks:""}),b=j.find(t=>t.id===parseInt(v)),le=async t=>{t.preventDefault();try{await p.mutateAsync({exam_id:parseInt(v),student_id:parseInt(D.student_id),marks_obtained:parseFloat(D.obtained_marks),remarks:D.remarks}),y(!1),z({student_id:"",obtained_marks:"",remarks:""}),E.success("Result added successfully!")}catch{E.error("Failed to add result")}},ne=async t=>{t.preventDefault();try{await d.mutateAsync({id:l.id,marks_obtained:parseFloat(D.obtained_marks),remarks:D.remarks}),x(!1),k(null),z({student_id:"",obtained_marks:"",remarks:""}),E.success("Result updated successfully!")}catch{E.error("Failed to update result")}},o=t=>{k(t),z({student_id:t.student_id,obtained_marks:t.obtained_marks.toString(),remarks:t.remarks||""}),x(!0)},M=()=>{if(!b||n.length===0){E.error("No results to export");return}const C=[["Student Name","Roll Number","Obtained Marks","Total Marks","Percentage","Grade","Remarks"].join(","),...n.map(L=>[`"${L.student?.name||"N/A"}"`,`"${L.student?.roll_number||"N/A"}"`,L.obtained_marks,b.total_marks,`${(L.obtained_marks/b.total_marks*100).toFixed(2)}%`,ce(L.obtained_marks,b.total_marks),`"${L.remarks||""}"`].join(","))].join(`
`),F=new Blob([C],{type:"text/csv"}),q=window.URL.createObjectURL(F),s=document.createElement("a");s.href=q,s.download=`${b.title}_Results.csv`,s.click(),window.URL.revokeObjectURL(q),E.success("Results exported successfully!")},ce=(t,C)=>{const F=t/C*100;return F>=90?"A+":F>=80?"A":F>=70?"B+":F>=60?"B":F>=50?"C":F>=40?"D":"F"},ie=n.map(t=>{const C=b?.students?.find(F=>F.id===t.student_id)||null;return{...t,student:C?{...C,name:C.name||"Unknown Student"}:null}}).filter(t=>!U||t.student?.name?.toLowerCase().includes(U.toLowerCase())||t.student?.roll_number?.toLowerCase().includes(U.toLowerCase())).sort((t,C)=>{switch(I){case"student_name":return(t.student?.name||"").localeCompare(C.student?.name||"");case"roll_number":return(t.student?.roll_number||"").localeCompare(C.student?.roll_number||"");case"marks_high":return C.obtained_marks-t.obtained_marks;case"marks_low":return t.obtained_marks-C.obtained_marks;case"percentage":const F=t.obtained_marks/(b?.total_marks||100)*100;return C.obtained_marks/(b?.total_marks||100)*100-F;default:return 0}}),B=b?.students?.filter(t=>!n.some(C=>C.student_id===t.id))||[];return A?N?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center space-y-3 sm:space-y-0",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(i,{variant:"outline",size:"sm",onClick:()=>S("/teacher"),className:"lg:hidden",children:e.jsx(Y,{className:"h-4 w-4"})}),e.jsx("h2",{className:"text-lg sm:text-xl font-semibold",children:"Exam Results"})]}),e.jsxs("div",{className:"flex space-x-2",children:[v&&n.length>0&&e.jsxs(i,{onClick:M,size:"sm",variant:"outline",children:[e.jsx(We,{className:"h-4 w-4 mr-1 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Export"})]}),v&&e.jsxs(i,{onClick:()=>y(!0),size:"sm",disabled:B.length===0,children:[e.jsx(re,{className:"h-4 w-4 mr-1 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:B.length>0?"Add Result":"All Results Added"}),e.jsx("span",{className:"sm:hidden",children:B.length>0?"Add":"Full"})]})]})]}),e.jsx(c,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Exam"}),e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:v,onChange:t=>{m(t.target.value),G("")},children:[e.jsx("option",{value:"",children:"Choose an exam to view results"}),j.map(t=>e.jsxs("option",{value:t.id,children:[t.title," - ",t.subject?.name," (",t.class?.name,")"]},t.id))]})]}),v&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search Students"}),e.jsxs("div",{className:"relative",children:[e.jsx(pe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by name or roll number...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:U,onChange:t=>G(t.target.value)})]})]}),e.jsxs("div",{className:"w-full lg:w-48",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sort By"}),e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:I,onChange:t=>$(t.target.value),children:[e.jsx("option",{value:"student_name",children:"Student Name"}),e.jsx("option",{value:"roll_number",children:"Roll Number"}),e.jsx("option",{value:"marks_high",children:"Marks (High to Low)"}),e.jsx("option",{value:"marks_low",children:"Marks (Low to High)"}),e.jsx("option",{value:"percentage",children:"Percentage"})]})]})]})]}),b&&e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center space-y-2 sm:space-y-0",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-blue-900",children:b.title}),e.jsxs("p",{className:"text-blue-700 text-sm",children:[b.subject?.name," • ",b.class?.name," • Total Marks: ",b.total_marks," • Date: ",new Date(b.exam_date).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[e.jsxs("div",{className:"text-sm text-blue-700",children:["Results: ",n.length," / ",b.students?.length||0," students",B.length>0&&e.jsxs("span",{className:"ml-2 text-orange-600 font-medium",children:["• ",B.length," pending"]})]}),B.length>0&&e.jsxs(i,{onClick:()=>y(!0),size:"sm",className:"bg-green-600 hover:bg-green-700",children:[e.jsx(re,{className:"h-4 w-4 mr-1"}),"Add Results (",B.length," pending)"]})]})]})})]})}),v&&e.jsx("div",{className:"space-y-4",children:h?e.jsx("div",{className:"flex justify-center items-center h-32",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):ie.length>0?e.jsxs(e.Fragment,{children:[e.jsx(c,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:n.length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Results"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:n.filter(t=>t.obtained_marks/b.total_marks*100>=40).length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Passed"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:n.filter(t=>t.obtained_marks/b.total_marks*100<40).length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Failed"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[n.length>0?(n.reduce((t,C)=>t+C.obtained_marks,0)/n.length/b.total_marks*100).toFixed(1):0,"%"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Avg Score"})]})]})}),e.jsx("div",{className:"space-y-4",children:ie.map(t=>{const C=(t.obtained_marks/b.total_marks*100).toFixed(2),F=ce(t.obtained_marks,b.total_marks),q=C>=40;return e.jsx(c,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-start space-y-2 sm:space-y-0",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-sm sm:text-base",children:t.student?.name||"Unknown Student"}),e.jsxs("p",{className:"text-gray-600 text-sm",children:["Roll: ",t.student?.roll_number||"N/A"]})]}),e.jsx("div",{className:"flex space-x-2",children:e.jsxs(i,{size:"sm",variant:"outline",onClick:()=>o(t),children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline ml-1",children:"Edit"})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-5 gap-4 text-xs sm:text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 block",children:"Obtained"}),e.jsxs("span",{className:"font-medium",children:[t.obtained_marks,"/",b.total_marks]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 block",children:"Percentage"}),e.jsxs("span",{className:`font-medium ${q?"text-green-600":"text-red-600"}`,children:[C,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 block",children:"Grade"}),e.jsx("span",{className:`font-medium ${q?"text-green-600":"text-red-600"}`,children:F})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 block",children:"Status"}),e.jsx("span",{className:`font-medium ${q?"text-green-600":"text-red-600"}`,children:q?"Passed":"Failed"})]}),e.jsxs("div",{className:"sm:col-span-1 col-span-2",children:[e.jsx("span",{className:"text-gray-500 block",children:"Remarks"}),e.jsx("span",{className:"text-gray-700",children:t.remarks||"No remarks"})]})]})]})},t.id)})})]}):n.length>0?e.jsx(c,{className:"p-8 text-center",children:e.jsx("p",{className:"text-gray-500",children:"No results found matching your search."})}):e.jsx(c,{className:"p-8 text-center",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Results Added Yet"}),e.jsxs("p",{className:"text-gray-500",children:[b?.students?.length||0," students are waiting for their results"]})]}),B.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i,{onClick:()=>y(!0),className:"bg-green-600 hover:bg-green-700",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Start Adding Results"]}),e.jsx("p",{className:"text-sm text-gray-400",children:"Click to add results one by one for each student"})]})]})})}),!v&&e.jsx(c,{className:"p-8 text-center",children:e.jsx("p",{className:"text-gray-500",children:"Please select an exam to view or add results"})}),e.jsx(V,{isOpen:a,onClose:()=>y(!1),title:"Add Student Result",className:"sm:max-w-lg",children:B.length>0?e.jsxs("form",{onSubmit:le,className:"space-y-4",children:[e.jsx(se,{label:"Student",value:D.student_id,onChange:t=>z({...D,student_id:t.target.value}),options:[{value:"",label:"Select student"},...B.map(t=>({value:t.id,label:`${t.name} (${t.roll_number})`}))],required:!0}),e.jsx(H,{label:`Obtained Marks (out of ${b?.total_marks||0})`,type:"number",step:"0.5",min:"0",max:b?.total_marks||100,value:D.obtained_marks,onChange:t=>z({...D,obtained_marks:t.target.value}),required:!0}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Remarks"}),e.jsx("textarea",{className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-sm",rows:3,value:D.remarks,onChange:t=>z({...D,remarks:t.target.value}),placeholder:"Enter any remarks or comments..."})]}),e.jsxs("div",{className:"flex flex-col-reverse sm:flex-row justify-end space-y-2 space-y-reverse sm:space-y-0 sm:space-x-3",children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>y(!1),children:"Cancel"}),e.jsx(i,{type:"submit",loading:p.isPending,children:"Add Result"})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-gray-500",children:"All students in this exam already have results."}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"You can view and edit existing results from the results list."})]})}),e.jsx(V,{isOpen:w,onClose:()=>x(!1),title:"Edit Student Result",className:"sm:max-w-lg",children:l&&e.jsxs("form",{onSubmit:ne,className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Student: "}),e.jsxs("span",{className:"text-gray-900",children:[l.student?.name," (",l.student?.roll_number,")"]})]}),e.jsx(H,{label:`Obtained Marks (out of ${b?.total_marks||0})`,type:"number",step:"0.5",min:"0",max:b?.total_marks||100,value:D.obtained_marks,onChange:t=>z({...D,obtained_marks:t.target.value}),required:!0}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Remarks"}),e.jsx("textarea",{className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-sm",rows:3,value:D.remarks,onChange:t=>z({...D,remarks:t.target.value}),placeholder:"Enter any remarks or comments..."})]}),e.jsxs("div",{className:"flex flex-col-reverse sm:flex-row justify-end space-y-2 space-y-reverse sm:space-y-0 sm:space-x-3",children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>x(!1),children:"Cancel"}),e.jsx(i,{type:"submit",loading:d.isPending,children:"Update Result"})]})]})})]}):e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center p-6 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(He,{className:"h-8 w-8 mx-auto text-red-600 mb-2"}),e.jsx("h3",{className:"text-lg font-medium text-red-900 mb-2",children:"Authentication Error"}),e.jsx("p",{className:"text-red-700",children:"Unable to identify teacher. Please log in again."})]})})},ns=()=>{const S=X(),{user:g}=Z(),A=g?.teacher_id||g?.teacherId,j=()=>["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][new Date().getDay()],[N,R]=u.useState(j()),[f,v]=u.useState("weekly"),{data:m=[],isLoading:n}=ge(A,f==="daily"?N:null),h=[{value:"saturday",label:"Saturday"},{value:"sunday",label:"Sunday"},{value:"monday",label:"Monday"},{value:"tuesday",label:"Tuesday"},{value:"wednesday",label:"Wednesday"},{value:"thursday",label:"Thursday"},{value:"friday",label:"Friday"}],p=a=>a===j(),d=h.reduce((a,y)=>(a[y.value]=m.filter(w=>w.day_of_week===y.value).sort((w,x)=>w.start_time.localeCompare(x.start_time)),a),{});return n?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-600"})}):e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center space-y-3 sm:space-y-0",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(i,{variant:"outline",size:"sm",onClick:()=>S("/teacher"),className:"lg:hidden",children:e.jsx(Y,{className:"h-4 w-4"})}),e.jsx("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-gray-900",children:"My Teaching Schedule"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("div",{className:"flex rounded-lg border border-gray-300",children:[e.jsxs(i,{variant:f==="weekly"?"default":"ghost",size:"sm",onClick:()=>v("weekly"),className:"rounded-r-none border-0",children:[e.jsx(Ke,{className:"h-4 w-4 mr-1"}),"Weekly"]}),e.jsxs(i,{variant:f==="daily"?"default":"ghost",size:"sm",onClick:()=>v("daily"),className:"rounded-l-none border-0",children:[e.jsx(Ve,{className:"h-4 w-4 mr-1"}),"Daily"]})]})})]}),f==="daily"&&e.jsx(c,{children:e.jsx(c.Content,{className:"p-4",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:h.map(a=>e.jsxs(i,{variant:N===a.value?"default":"outline",size:"sm",onClick:()=>R(a.value),className:p(a.value)?"ring-2 ring-blue-300":"",children:[a.label,p(a.value)&&e.jsx("span",{className:"ml-1 text-xs",children:"(Today)"})]},a.value))})})}),f==="weekly"?e.jsxs(c,{children:[e.jsx(c.Header,{className:"p-4 sm:p-6",children:e.jsxs(c.Title,{className:"text-lg sm:text-xl flex items-center gap-2",children:[e.jsx(J,{className:"h-5 w-5"}),"My Weekly Teaching Schedule"]})}),e.jsx(c.Content,{className:"p-0",children:e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-7 divide-y lg:divide-y-0 lg:divide-x",children:h.map(a=>{const y=d[a.value]||[],w=j(),x=a.value===w;return e.jsxs("div",{className:`p-4 ${x?"bg-green-50":""}`,children:[e.jsx("div",{className:"mb-3",children:e.jsxs("h3",{className:`font-semibold ${x?"text-green-900":"text-gray-900"}`,children:[a.label,x&&e.jsx("span",{className:"ml-1 text-xs text-green-600",children:"(Today)"})]})}),e.jsx("div",{className:"space-y-2",children:y.length>0?y.map(T=>e.jsxs("div",{className:"p-3 rounded-lg border-l-4 border-green-500 bg-green-50",children:[e.jsxs("div",{className:"text-xs font-medium text-green-600 mb-1",children:[T.start_time," - ",T.end_time]}),e.jsx("div",{className:"font-medium text-sm text-green-900 mb-1",children:T.subject?.name}),e.jsxs("div",{className:"text-xs text-green-700 mb-1",children:["Class: ",T.class_assigned?.name]}),T.room_number&&e.jsxs("div",{className:"text-xs text-green-600",children:["Room: ",T.room_number]})]},T.id)):e.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e.jsx(we,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No classes"})]})})]},a.value)})})})]}):e.jsxs(c,{children:[e.jsx(c.Header,{children:e.jsxs(c.Title,{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-5 w-5"}),h.find(a=>a.value===N)?.label," Schedule"]})}),e.jsx(c.Content,{children:m.length>0?e.jsx("div",{className:"space-y-4",children:m.map(a=>e.jsx("div",{className:"bg-green-50 p-4 rounded-lg border-l-4 border-green-500",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(we,{className:"h-4 w-4 text-gray-600"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[a.start_time," - ",a.end_time]})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(he,{className:"h-4 w-4 text-green-600"}),e.jsx("h3",{className:"font-semibold text-green-900",children:a.subject?.name||"Subject"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm text-gray-700",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Class:"})," ",a.class_assigned?.name||"N/A"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Subject Code:"})," ",a.subject?.code||"N/A"]}),a.room_number&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Room:"})," ",a.room_number]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Duration:"})," ",(()=>{const y=new Date(`1970-01-01T${a.start_time}:00`);return`${(new Date(`1970-01-01T${a.end_time}:00`)-y)/(1e3*60)} minutes`})()]})]})]})})},a.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(J,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Classes Scheduled"}),e.jsxs("p",{className:"text-gray-500",children:["No classes are scheduled for ",h.find(a=>a.value===N)?.label.toLowerCase(),"."]})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:m.length}),e.jsx("div",{className:"text-sm text-gray-600",children:f==="daily"?"Classes Today":"Total Classes"})]})}),e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:m.length>0?(()=>{const a=m.reduce((y,w)=>{const x=new Date(`1970-01-01T${w.start_time}:00`),T=new Date(`1970-01-01T${w.end_time}:00`);return y+(T-x)/6e4},0);return`${Math.round(a/60*10)/10}h`})():"0h"}),e.jsx("div",{className:"text-sm text-gray-600",children:f==="daily"?"Hours Today":"Total Hours/Week"})]})}),e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:m.length>0?new Set(m.map(a=>a.class_id)).size:0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Different Classes"})]})}),e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:m.length>0?new Set(m.map(a=>a.subject_id)).size:0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Subjects Teaching"})]})})]})]})};export{Ze as A,es as T,ss as a,as as b,ts as c,ls as d,rs as e,ns as f,Z as u};
